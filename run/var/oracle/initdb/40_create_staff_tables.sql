ALTER SESSION SET CONTAINER=XEPDB1;
set serveroutput on

-- The production server relies on a central support schema that contains public
-- tables containing staff and group information.  Without access to those tables
-- via synonym, we instead create barebones replica tables.
CREATE TABLE CED3_OWNER.STAFF
(
    STAFF_ID          INTEGER                     NOT NULL,
    USERNAME          VARCHAR2(32 BYTE),
    LASTNAME          VARCHAR2(60 BYTE),
    FIRSTNAME         VARCHAR2(30 BYTE),
    SP_STATUS         VARCHAR2(32 BYTE) DEFAULT 'PRESENT',
    EMAIL             VARCHAR2(30 BYTE)
);

ALTER TABLE CED3_OWNER.STAFF
  ADD CONSTRAINT valid_sp_status check ( sp_status in ('PRESENT','ABSENT') );

ALTER TABLE CED3_OWNER.STAFF ADD (
  CONSTRAINT STAFF_PK
  PRIMARY KEY
  (STAFF_ID)
);

CREATE TABLE CED3_OWNER.WORKGROUP
(
    WORKGROUP_ID  INTEGER                         NOT NULL,
    DESCRIPTION   VARCHAR2(512 CHAR)              NOT NULL,
    NAME          VARCHAR2(32 CHAR)               NOT NULL
);

ALTER TABLE CED3_OWNER.WORKGROUP ADD (
  CONSTRAINT WORKGROUP_PK
  PRIMARY KEY
  (WORKGROUP_ID)
);

CREATE TABLE CED3_OWNER.WORKGROUP_MEMBERSHIP
(
    STAFF_ID      INTEGER                         NOT NULL,
    WORKGROUP_ID  INTEGER                         NOT NULL
);

CREATE UNIQUE INDEX WORKGROUP_MEMBERSHIP_PK ON CED3_OWNER.WORKGROUP_MEMBERSHIP
    (STAFF_ID, WORKGROUP_ID);


ALTER TABLE CED3_OWNER.WORKGROUP_MEMBERSHIP ADD (
  CONSTRAINT WORKGROUP_MEMBERSHIP_PK
  PRIMARY KEY
  (STAFF_ID, WORKGROUP_ID)
  USING INDEX WORKGROUP_MEMBERSHIP_PK
  ENABLE VALIDATE);

ALTER TABLE CED3_OWNER.WORKGROUP_MEMBERSHIP ADD (
  CONSTRAINT WORKGROUP_MEMBERSHIP_FK1
  FOREIGN KEY (STAFF_ID)
  REFERENCES CED3_OWNER.STAFF (STAFF_ID)
  ON DELETE CASCADE
  ENABLE VALIDATE
, CONSTRAINT WORKGROUP_MEMBERSHIP_FK2
  FOREIGN KEY (WORKGROUP_ID)
  REFERENCES CED3_OWNER.WORKGROUP (WORKGROUP_ID)
  ENABLE VALIDATE);

GRANT SELECT ON CED3_OWNER.STAFF TO READ_CED;
GRANT SELECT ON CED3_OWNER.WORKGROUP TO READ_CED;
GRANT SELECT ON CED3_OWNER.WORKGROUP_MEMBERSHIP TO READ_CED;


